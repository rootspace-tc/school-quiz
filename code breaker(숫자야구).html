<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì½”ë“œ ë¸Œë ˆì´ì»¤ (Code Breaker)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Jua', sans-serif;
            background-color: #1a202c;
            color: #e2e8f0;
        }
        .game-panel, .scoreboard-panel {
            background-color: #2d3748;
            border: 1px solid #4a5568;
        }
        .number-input {
            font-family: 'Jua', sans-serif;
            width: 60px;
            height: 70px;
            text-align: center;
            font-size: 2.5rem;
            border: 2px solid #4a5568;
            background-color: #1a202c;
            color: #e2e8f0;
            border-radius: 0.5rem;
            margin: 0 5px;
            -moz-appearance: textfield; /* Firefox */
        }
        .number-input::-webkit-outer-spin-button,
        .number-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .btn-primary {
            background-color: #4299e1;
            color: white;
            transition: background-color 0.3s;
        }
        .btn-primary:hover {
            background-color: #3182ce;
        }
        .btn-primary:disabled {
            background-color: #4a5568;
            cursor: not-allowed;
        }
        .btn-secondary {
            background-color: #4a5568;
        }
        .btn-secondary:hover {
            background-color: #2d3748;
        }
        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            border-radius: 8px;
            background-color: #1a202c;
            margin-bottom: 8px;
            font-size: 1.2rem;
            letter-spacing: 2px;
        }
        .strike { color: #48bb78; } /* ì´ˆë¡ìƒ‰ */
        .ball { color: #f6ad55; } /* ì£¼í™©ìƒ‰ */
        #rules-toggle:checked ~ #rules-content {
            display: block;
        }
        #scoreboard-list li {
            display: grid;
            grid-template-columns: 50px 1fr auto;
            align-items: center;
            gap: 10px;
            padding: 8px 4px;
            border-bottom: 1px solid #4a5568;
        }
        #scoreboard-list li:last-child {
            border-bottom: none;
        }
        .rank { font-weight: bold; color: #63b3ed; }
        .name { color: #e2e8f0; cursor: pointer; transition: color 0.2s; text-align: center; }
        .name:hover { color: #f6ad55; }
        .score { color: #a0aec0; }
        .scoreboard-input {
            background-color: #1a202c;
            border: 1px solid #63b3ed;
            color: #e2e8f0;
            border-radius: 4px;
            padding: 2px 6px;
            width: 100%;
            text-align: center;
            font-family: 'Jua', sans-serif;
            font-size: 1.125rem; /* 18px */
        }
    </style>
</head>
<body class="p-4">

    <div id="game-container" class="w-full flex flex-col lg:flex-row items-start justify-center gap-8">
        <!-- Game Panel -->
        <div class="game-panel w-full max-w-md mx-auto p-6 rounded-xl shadow-2xl">
            <header class="text-center mb-6">
                <h1 class="text-5xl font-bold text-blue-400 tracking-wider">Code Breaker</h1>
                <p class="text-gray-400 mt-2">ë¹„ë°€ ì½”ë“œë¥¼ ì¶”ë¦¬í•˜ì—¬ í•´ì œí•˜ì„¸ìš”!</p>
            </header>

            <main>
                <!-- ê²Œì„ ê·œì¹™ ì„¹ì…˜ -->
                <div class="mb-4 bg-gray-900 rounded-lg p-3">
                    <label for="rules-toggle" class="cursor-pointer flex justify-between items-center">
                        <h2 class="text-xl font-semibold">ğŸ“œ ê²Œì„ ê·œì¹™</h2>
                        <span class="text-2xl transform transition-transform duration-300">â–¼</span>
                    </label>
                    <input type="checkbox" id="rules-toggle" class="hidden">
                    <div id="rules-content" class="hidden mt-3 text-gray-300 border-t border-gray-700 pt-3">
                        <ul class="list-disc list-inside space-y-1">
                            <li>ì»´í“¨í„°ê°€ 0~9 ì‚¬ì´ì˜ **ì¤‘ë³µ ê°€ëŠ¥í•œ** 4ìë¦¬ ì½”ë“œë¥¼ ë§Œë“­ë‹ˆë‹¤.</li>
                            <li>ìµœì†Œí•œì˜ íšŸìˆ˜ë¡œ ì½”ë“œë¥¼ ë§í˜€ ëª…ì˜ˆì˜ ì „ë‹¹ì— ì´ë¦„ì„ ì˜¬ë¦¬ì„¸ìš”!</li>
                            <li><span class="strike font-bold">Strike(S)</span>: ìˆ«ìì™€ ìœ„ì¹˜ ëª¨ë‘ ì •ë‹µ</li>
                            <li><span class="ball font-bold">Ball(B)</span>: ìˆ«ìëŠ” ë§ì§€ë§Œ ìœ„ì¹˜ê°€ í‹€ë¦¼</li>
                        </ul>
                    </div>
                </div>

                <!-- ì¶”ì¸¡ ê¸°ë¡ -->
                <div id="history" class="h-80 overflow-y-auto mb-4 p-2 bg-gray-900 rounded-lg">
                    <!-- ì¶”ì¸¡ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>

                <!-- ë©”ì‹œì§€ ì˜ì—­ -->
                <div id="message" class="text-center text-lg h-8 mb-4"></div>

                <!-- ìˆ«ì ì…ë ¥ ì˜ì—­ -->
                <div id="input-area" class="flex justify-center mb-4">
                    <input type="number" class="number-input" min="0" max="9" maxlength="1">
                    <input type="number" class="number-input" min="0" max="9" maxlength="1">
                    <input type="number" class="number-input" min="0" max="9" maxlength="1">
                    <input type="number" class="number-input" min="0" max="9" maxlength="1">
                </div>

                <!-- ë²„íŠ¼ ì˜ì—­ -->
                <div class="flex space-x-4">
                    <button id="guess-button" class="w-full py-3 text-xl font-bold rounded-lg btn-primary">ì¶”ì¸¡í•˜ê¸°</button>
                    <button id="new-game-button" class="w-full py-3 text-xl font-bold rounded-lg btn-secondary">ìƒˆ ê²Œì„</button>
                </div>
            </main>
        </div>

        <!-- Scoreboard Panel -->
        <div id="scoreboard-panel" class="scoreboard-panel w-full max-w-md mx-auto p-6 rounded-xl shadow-2xl">
            <header class="text-center mb-6">
                <h1 class="text-4xl font-bold text-yellow-400">ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹</h1>
            </header>
            <ol id="scoreboard-list" class="text-lg space-y-2">
                <!-- ì ìˆ˜ ê¸°ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </ol>
        </div>
    </div>

    <script>
        // --- DOM ìš”ì†Œ ---
        const numberInputs = document.querySelectorAll('.number-input');
        const guessButton = document.getElementById('guess-button');
        const newGameButton = document.getElementById('new-game-button');
        const historyContainer = document.getElementById('history');
        const messageEl = document.getElementById('message');
        const scoreboardList = document.getElementById('scoreboard-list');

        // --- ê²Œì„ ì„¤ì • ---
        const CODE_LENGTH = 4;
        const DIGIT_MIN = 0;
        const DIGIT_MAX = 9;
        const SCOREBOARD_KEY = 'codeBreakerScores_v4'; // ë°ì´í„° êµ¬ì¡° ë³€ê²½ìœ¼ë¡œ ë²„ì „ ì—…ë°ì´íŠ¸
        const MAX_SCORES = 10;

        // --- ê²Œì„ ìƒíƒœ ë³€ìˆ˜ ---
        let secretCode = [];
        let guessCount = 0;
        let isGameOver = false;

        // --- í•¨ìˆ˜ ---

        /**
         * ìƒˆ ê²Œì„ì„ ì‹œì‘í•˜ëŠ” í•¨ìˆ˜
         */
        function newGame() {
            secretCode = [];
            for (let i = 0; i < CODE_LENGTH; i++) {
                const randomNumber = Math.floor(Math.random() * (DIGIT_MAX - DIGIT_MIN + 1)) + DIGIT_MIN;
                secretCode.push(randomNumber);
            }
            console.log("ë¹„ë°€ ì½”ë“œ:", secretCode);

            guessCount = 0;
            isGameOver = false;

            historyContainer.innerHTML = '';
            messageEl.textContent = `ì¶”ì¸¡ íšŸìˆ˜: ${guessCount}ë²ˆ`;
            messageEl.classList.remove('text-red-400', 'text-green-400', 'text-yellow-400');
            numberInputs.forEach(input => {
                input.value = '';
                input.disabled = false;
            });
            guessButton.disabled = false;
            numberInputs[0].focus();
        }

        /**
         * í”Œë ˆì´ì–´ì˜ ì¶”ì¸¡ì„ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜
         */
        function handleGuess() {
            if (isGameOver) return;

            const guess = Array.from(numberInputs).map(input => parseInt(input.value));
            if (guess.some(isNaN)) {
                showMessage("ëª¨ë“  ì¹¸ì— ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”.", "error");
                return;
            }
            
            guessCount++;
            
            let strikes = 0;
            let balls = 0;
            const codeCopy = [...secretCode];
            const guessCopy = [...guess];

            for (let i = 0; i < CODE_LENGTH; i++) {
                if (guessCopy[i] === codeCopy[i]) {
                    strikes++;
                    guessCopy[i] = null;
                    codeCopy[i] = null;
                }
            }
            for (let i = 0; i < CODE_LENGTH; i++) {
                if (guessCopy[i] !== null) {
                    const ballIndex = codeCopy.indexOf(guessCopy[i]);
                    if (ballIndex !== -1) {
                        balls++;
                        codeCopy[ballIndex] = null;
                    }
                }
            }
            
            addHistory(guess, strikes, balls);

            if (strikes === CODE_LENGTH) {
                endGame(true);
                return;
            }

            messageEl.textContent = `ì¶”ì¸¡ íšŸìˆ˜: ${guessCount}ë²ˆ`;
            numberInputs.forEach(input => input.value = '');
            numberInputs[0].focus();
        }
        
        function addHistory(guess, strikes, balls) {
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item animate-pulse';
            const guessText = guess.join(' ');
            const feedbackText = `<span class="strike">${strikes}S</span> <span class="ball">${balls}B</span>`;
            historyItem.innerHTML = `<div class="flex items-center"><span class="text-sm text-gray-400 mr-3">${String(guessCount).padStart(2, '0')}íšŒ</span><div class="font-mono">${guessText}</div></div><div class="font-bold">${feedbackText}</div>`;
            historyContainer.prepend(historyItem);
            setTimeout(() => historyItem.classList.remove('animate-pulse'), 500);
        }

        function endGame(didWin) {
            isGameOver = true;
            numberInputs.forEach(input => input.disabled = true);
            guessButton.disabled = true;
            if (didWin) {
                showMessage(`ğŸ‰ ì •ë‹µ! ${guessCount}ë²ˆ ë§Œì— ì„±ê³µ!`, "win");
                saveScore(guessCount);
            }
        }
        
        function showMessage(text, type = "info") {
            messageEl.textContent = text;
            messageEl.classList.remove('text-red-400', 'text-green-400');
            if (type === "error") messageEl.classList.add('text-red-400');
            if (type === "win") messageEl.classList.add('text-green-400');
            
            if (type === "error") {
                setTimeout(() => {
                    if(!isGameOver) messageEl.textContent = `ì¶”ì¸¡ íšŸìˆ˜: ${guessCount}ë²ˆ`;
                }, 2000);
            }
        }

        /**
         * ëª…ì˜ˆì˜ ì „ë‹¹ ì ìˆ˜ë¥¼ ë¶ˆëŸ¬ì™€ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
         */
        function loadAndDisplayScores() {
            const scores = JSON.parse(localStorage.getItem(SCOREBOARD_KEY)) || [];
            scoreboardList.innerHTML = '';
            if (scores.length === 0) {
                scoreboardList.innerHTML = '<li class="text-gray-500 justify-center col-span-3">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</li>';
                return;
            }
            
            scores.forEach((scoreData, index) => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <span class="rank">${index + 1}ìœ„</span>
                    <span class="name">${scoreData.name}</span>
                    <span class="score">${scoreData.score}ë²ˆ ë§Œì— ì„±ê³µ</span>`;
                
                li.addEventListener('click', () => handleNameEdit(li, index));
                scoreboardList.appendChild(li);
            });
        }

        /**
         * ì´ë¦„ ìˆ˜ì •ì„ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜
         */
        function handleNameEdit(listItem, index) {
            if (listItem.querySelector('input')) return; // ì´ë¯¸ ìˆ˜ì • ì¤‘ì´ë©´ ë¬´ì‹œ

            const nameSpan = listItem.querySelector('.name');
            const currentName = nameSpan.textContent;
            
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'scoreboard-input';
            input.value = currentName === 'ì´ë¦„ ì—†ìŒ' ? '' : currentName;
            input.placeholder = 'ì´ë¦„ ì…ë ¥';

            const save = () => {
                const newName = input.value.trim();
                saveName(index, newName);
            };

            input.addEventListener('blur', save);
            input.addEventListener('keydown', e => {
                if (e.key === 'Enter') input.blur();
                if (e.key === 'Escape') loadAndDisplayScores(); // ì·¨ì†Œí•˜ê³  ë‹¤ì‹œ ê·¸ë¦¬ê¸°
            });

            nameSpan.replaceWith(input);
            input.focus();
            input.select();
        }
        
        /**
         * ìˆ˜ì •ëœ ì´ë¦„ì„ ì €ì¥í•˜ëŠ” í•¨ìˆ˜
         */
        function saveName(index, newName) {
            const scores = JSON.parse(localStorage.getItem(SCOREBOARD_KEY)) || [];
            if (scores[index]) {
                scores[index].name = newName || 'ì´ë¦„ ì—†ìŒ';
                localStorage.setItem(SCOREBOARD_KEY, JSON.stringify(scores));
            }
            loadAndDisplayScores(); // í™”ë©´ ìƒˆë¡œê³ ì¹¨
        }

        /**
         * ìƒˆë¡œìš´ ì ìˆ˜ë¥¼ ëª…ì˜ˆì˜ ì „ë‹¹ì— ì €ì¥í•˜ëŠ” í•¨ìˆ˜
         */
        function saveScore(newScore) {
            const scores = JSON.parse(localStorage.getItem(SCOREBOARD_KEY)) || [];
            scores.push({ score: newScore, name: 'ì´ë¦„ ì—†ìŒ' });
            scores.sort((a, b) => a.score - b.score);
            const newScores = scores.slice(0, MAX_SCORES);
            localStorage.setItem(SCOREBOARD_KEY, JSON.stringify(newScores));
            loadAndDisplayScores();
        }

        // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
        newGameButton.addEventListener('click', newGame);
        guessButton.addEventListener('click', handleGuess);

        numberInputs.forEach((input, index) => {
            input.addEventListener('keydown', (e) => {
                if (e.key === "Enter") {
                    e.preventDefault();
                    handleGuess();
                }
                if (e.key === "Backspace" && index > 0 && input.value === '') {
                    numberInputs[index - 1].focus();
                }
            });
            input.addEventListener('input', () => {
                if (input.value && index < numberInputs.length - 1) {
                    numberInputs[index + 1].focus();
                }
            });
        });

        // --- ì´ˆê¸° ì‹¤í–‰ ---
        newGame();
        loadAndDisplayScores();

    </script>
</body>
</html>

