<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë””ì§€í„¸ ë¬¼ê°ë†€ì´: ì»¬ëŸ¬ ë§¤ì¹˜</title>
    <!-- Tailwind CSS (ìŠ¤íƒ€ì¼ë§) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ì•„ì´ì½˜ ì‚¬ìš©ì„ ìœ„í•œ FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Jua&display=swap');

        body {
            font-family: 'Jua', sans-serif;
            background-color: #f0f9ff;
            user-select: none;
            overflow: hidden; /* ìŠ¤í¬ë¡¤ ë°©ì§€ */
            margin: 0;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ì„ì´ëŠ” íš¨ê³¼ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes mix-swirl {
            0% { border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%; transform: rotate(0deg); }
            33% { border-radius: 70% 30% 30% 70% / 60% 40% 40% 60%; transform: rotate(120deg); }
            66% { border-radius: 30% 70% 60% 40% / 50% 60% 30% 70%; transform: rotate(240deg); }
            100% { border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%; transform: rotate(360deg); }
        }

        .mixing-blob {
            transition: background-color 0.5s ease;
            animation: mix-swirl 6s linear infinite;
            box-shadow: inset -10px -10px 30px rgba(0,0,0,0.1), 10px 10px 30px rgba(0,0,0,0.1);
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .paint-btn-body {
            position: relative;
            overflow: hidden;
            border-bottom-width: 8px;
            transition: transform 0.1s;
        }
        .paint-btn:active .paint-btn-body {
            transform: scale(0.95);
            border-bottom-width: 2px;
            margin-top: 6px;
        }
        .paint-shine {
            position: absolute;
            top: 0;
            width: 100%;
            height: 12px;
            background-color: rgba(255,255,255,0.3);
        }
        .paint-shadow {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 6px;
            background-color: rgba(0,0,0,0.15);
        }
        
        /* ê²°ê³¼ ëª¨ë‹¬ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes slide-up {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .modal-content {
            animation: slide-up 0.3s ease-out;
        }

        /* ë°˜ì‘í˜• ì»¨í…Œì´ë„ˆ */
        #game-container-wrapper {
            /* ì´ˆê¸° í¬ê¸° ì„¤ì • (ê¸°ì¤€ í•´ìƒë„) */
            width: 1024px; 
            /* heightëŠ” ë‚´ìš©ì— ë”°ë¼ ìœ ë™ì ì´ì§€ë§Œ ê¸°ì¤€ì„ ì¡ìŒ */
            transform-origin: center center;
            transition: transform 0.1s ease-out; /* ë¶€ë“œëŸ¬ìš´ ë¦¬ì‚¬ì´ì§• */
        }
    </style>
</head>
<body>

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ ë˜í¼ (ìë™ ìŠ¤ì¼€ì¼ë§ ëŒ€ìƒ) -->
    <div id="game-container-wrapper">
        <!-- ì‹¤ì œ ê²Œì„ UI ì»¨í…Œì´ë„ˆ -->
        <div class="bg-white rounded-[3rem] shadow-2xl p-10 w-full relative overflow-hidden border-4 border-indigo-50">
            
            <!-- ìƒë‹¨ í—¤ë” -->
            <header class="text-center mb-10">
                <h1 class="text-6xl text-indigo-600 mb-4 drop-shadow-sm">ğŸ¨ ìƒ‰ì„ ì„ìœ¼ë©´? </h1>
                <p class="text-gray-500 text-2xl">ë²„íŠ¼ ìƒ‰ê³¼ ë˜‘ê°™ì€ ë¬¼ê°ìœ¼ë¡œ ëª©í‘œ ìƒ‰ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”!<br>(ì‹¤ì œ ë¬¼ê°ê³¼ ì¡°ê¸ˆ ë‹¤ë¥¼ ìˆ˜ ìˆì–´ìš”.)</p>
            </header>

            <!-- ê²Œì„ ì˜ì—­ -->
            <div class="flex justify-around items-center mb-12 px-10 gap-10">
                <!-- ëª©í‘œ ìƒ‰ìƒ (Target) -->
                <div class="flex flex-col items-center">
                    <span class="text-gray-600 text-3xl mb-6">ëª©í‘œ ìƒ‰ìƒ</span>
                    <div id="target-color" class="w-64 h-64 rounded-full shadow-inner border-[12px] border-gray-100 relative mixing-blob">
                        <div id="target-overlay" class="absolute inset-0 flex items-center justify-center text-white text-4xl opacity-0 transition-opacity bg-black/20 rounded-full">
                            ì •ë‹µ!
                        </div>
                    </div>
                </div>

                <!-- VS ë°°ì§€ -->
                <div class="text-6xl font-black text-gray-200 italic">VS</div>

                <!-- ë‚´ ìƒ‰ìƒ (Current) -->
                <div class="flex flex-col items-center">
                    <span class="text-gray-600 text-3xl mb-6">ë‚´ê°€ ë§Œë“  ìƒ‰</span>
                    <div id="my-color" class="w-64 h-64 rounded-full shadow-inner border-[12px] border-gray-100 bg-white mixing-blob relative flex items-center justify-center">
                        <span id="empty-msg" class="text-gray-300 text-2xl text-center leading-relaxed">ë¬¼ê°ì„<br>ì§œì£¼ì„¸ìš”</span>
                    </div>
                </div>
            </div>

            <!-- ë¬¼ê° íŒ”ë ˆíŠ¸ -->
            <div class="bg-gray-50 rounded-[2.5rem] p-8 mb-10 border-2 border-gray-100">
                <div class="grid grid-cols-5 gap-6 mb-8">
                    <!-- 1. ë¹¨ê°• -->
                    <button onclick="addDrop('red')" class="paint-btn flex flex-col items-center gap-3 group">
                        <div class="paint-btn-body w-full h-24 bg-red-500 rounded-b-3xl rounded-t-lg shadow-xl border-red-700">
                            <div class="paint-shine"></div><div class="paint-shadow"></div>
                        </div>
                        <span class="text-xl text-gray-600 group-hover:text-red-500 transition-colors">ë¹¨ê°•</span>
                    </button>
                    <!-- 2. ì£¼í™© -->
                    <button onclick="addDrop('orange')" class="paint-btn flex flex-col items-center gap-3 group">
                        <div class="paint-btn-body w-full h-24 bg-orange-500 rounded-b-3xl rounded-t-lg shadow-xl border-orange-700">
                            <div class="paint-shine"></div><div class="paint-shadow"></div>
                        </div>
                        <span class="text-xl text-gray-600 group-hover:text-orange-500 transition-colors">ì£¼í™©</span>
                    </button>
                    <!-- 3. ë…¸ë‘ -->
                    <button onclick="addDrop('yellow')" class="paint-btn flex flex-col items-center gap-3 group">
                        <div class="paint-btn-body w-full h-24 bg-yellow-400 rounded-b-3xl rounded-t-lg shadow-xl border-yellow-600">
                            <div class="paint-shine"></div><div class="paint-shadow"></div>
                        </div>
                        <span class="text-xl text-gray-600 group-hover:text-yellow-500 transition-colors">ë…¸ë‘</span>
                    </button>
                    <!-- 4. ì´ˆë¡ -->
                    <button onclick="addDrop('green')" class="paint-btn flex flex-col items-center gap-3 group">
                        <div class="paint-btn-body w-full h-24 bg-green-500 rounded-b-3xl rounded-t-lg shadow-xl border-green-700">
                            <div class="paint-shine"></div><div class="paint-shadow"></div>
                        </div>
                        <span class="text-xl text-gray-600 group-hover:text-green-500 transition-colors">ì´ˆë¡</span>
                    </button>
                    <!-- 5. íŒŒë‘ -->
                    <button onclick="addDrop('blue')" class="paint-btn flex flex-col items-center gap-3 group">
                        <div class="paint-btn-body w-full h-24 bg-blue-600 rounded-b-3xl rounded-t-lg shadow-xl border-blue-800">
                            <div class="paint-shine"></div><div class="paint-shadow"></div>
                        </div>
                        <span class="text-xl text-gray-600 group-hover:text-blue-600 transition-colors">íŒŒë‘</span>
                    </button>
                    
                    <!-- 6. ë³´ë¼ -->
                    <button onclick="addDrop('purple')" class="paint-btn flex flex-col items-center gap-3 group">
                        <div class="paint-btn-body w-full h-24 bg-purple-600 rounded-b-3xl rounded-t-lg shadow-xl border-purple-800">
                            <div class="paint-shine"></div><div class="paint-shadow"></div>
                        </div>
                        <span class="text-xl text-gray-600 group-hover:text-purple-600 transition-colors">ë³´ë¼</span>
                    </button>
                    <!-- 7. ë¶„í™ -->
                    <button onclick="addDrop('pink')" class="paint-btn flex flex-col items-center gap-3 group">
                        <div class="paint-btn-body w-full h-24 bg-pink-400 rounded-b-3xl rounded-t-lg shadow-xl border-pink-600">
                            <div class="paint-shine"></div><div class="paint-shadow"></div>
                        </div>
                        <span class="text-xl text-gray-600 group-hover:text-pink-400 transition-colors">ë¶„í™</span>
                    </button>
                     <!-- 8. ê°ˆìƒ‰ -->
                     <button onclick="addDrop('brown')" class="paint-btn flex flex-col items-center gap-3 group">
                        <div class="paint-btn-body w-full h-24 bg-[#8B4513] rounded-b-3xl rounded-t-lg shadow-xl border-[#5e2f0d]">
                            <div class="paint-shine"></div><div class="paint-shadow"></div>
                        </div>
                        <span class="text-xl text-gray-600 group-hover:text-[#8B4513] transition-colors">ê°ˆìƒ‰</span>
                    </button>
                    <!-- 9. í°ìƒ‰ -->
                    <button onclick="addDrop('white')" class="paint-btn flex flex-col items-center gap-3 group">
                        <div class="paint-btn-body w-full h-24 bg-white rounded-b-3xl rounded-t-lg shadow-xl border-gray-300 border-2">
                            <div class="paint-shine"></div><div class="paint-shadow"></div>
                        </div>
                        <span class="text-xl text-gray-600 group-hover:text-gray-400 transition-colors">í°ìƒ‰</span>
                    </button>
                    <!-- 10. ê²€ì • -->
                    <button onclick="addDrop('black')" class="paint-btn flex flex-col items-center gap-3 group">
                        <div class="paint-btn-body w-full h-24 bg-gray-800 rounded-b-3xl rounded-t-lg shadow-xl border-black">
                            <div class="paint-shine"></div><div class="paint-shadow"></div>
                        </div>
                        <span class="text-xl text-gray-600 group-hover:text-gray-800 transition-colors">ê²€ì •</span>
                    </button>
                </div>
                
                <!-- í˜„ì¬ ë¹„ìœ¨ í‘œì‹œê¸° -->
                <div id="recipe-display" class="h-16 bg-white rounded-2xl flex overflow-hidden shadow-inner text-xl text-white items-center justify-center border border-gray-200">
                    <span class="text-gray-400">ì•„ì§ ë¬¼ê°ì„ ë„£ì§€ ì•Šì•˜ì–´ìš”</span>
                </div>
            </div>

            <!-- ì•¡ì…˜ ë²„íŠ¼ -->
            <div class="flex gap-6">
                <button onclick="resetMix()" class="flex-1 py-5 bg-gray-200 hover:bg-gray-300 text-gray-600 text-2xl rounded-2xl transition-colors font-bold shadow-md">
                    <i class="fa-solid fa-rotate-left mr-3"></i>ë‹¤ì‹œí•˜ê¸°
                </button>
                <button onclick="checkResult()" class="flex-[2] py-5 bg-indigo-600 hover:bg-indigo-700 text-white text-2xl rounded-2xl shadow-xl transition-all hover:scale-[1.01] hover:shadow-2xl animate-pulse-slow font-bold">
                    <i class="fa-solid fa-check mr-3"></i>ì œì¶œí•˜ê¸°!
                </button>
            </div>

            <!-- ê²°ê³¼ ëª¨ë‹¬ -->
            <div id="result-modal" class="hidden absolute inset-0 bg-black/60 backdrop-blur-md z-50 flex items-center justify-center p-4">
                <div class="bg-white w-full max-w-lg rounded-[2.5rem] p-10 text-center shadow-2xl modal-content flex flex-col max-h-[90vh] overflow-y-auto">
                    <div id="result-icon" class="text-8xl mb-6">ğŸ‰</div>
                    <h2 id="result-title" class="text-5xl mb-4">ì™„ë²½í•´ìš”!</h2>
                    <p id="result-desc" class="text-gray-500 text-2xl mb-10">ìƒ‰ê°ì´ ì •ë§ ë›°ì–´ë‚˜ì‹œë„¤ìš”!</p>
                    
                    <div class="flex justify-center items-center gap-8 mb-8">
                        <div class="flex flex-col items-center">
                            <span class="text-xl text-gray-500 mb-3">ëª©í‘œ</span>
                            <div id="modal-target-color" class="w-24 h-24 rounded-full shadow-lg border-4 border-gray-100"></div>
                        </div>
                        <div class="text-5xl text-gray-300">âœ</div>
                        <div class="flex flex-col items-center">
                            <span class="text-xl text-gray-500 mb-3">ê²°ê³¼</span>
                            <div id="modal-my-color" class="w-24 h-24 rounded-full shadow-lg border-4 border-gray-100"></div>
                        </div>
                    </div>

                    <!-- ì ìˆ˜ ë°” -->
                    <div class="w-full bg-gray-200 rounded-full h-8 mb-4 overflow-hidden shadow-inner">
                        <div id="score-bar" class="bg-green-500 h-8 rounded-full transition-all duration-1000" style="width: 0%"></div>
                    </div>
                    <p id="score-text" class="text-5xl text-indigo-600 mb-8 font-bold">98ì </p>
                    
                    <!-- ì •ë‹µ ë ˆì‹œí”¼ ë³´ê¸° ì˜ì—­ -->
                    <div id="answer-section" class="hidden mb-8 bg-indigo-50 rounded-2xl p-6 border-2 border-indigo-100">
                        <h3 class="text-2xl text-indigo-800 mb-4 font-bold">ğŸ¤« ì •ë‹µ ë¹„ë²• ë ˆì‹œí”¼</h3>
                        <!-- ë ˆì‹œí”¼ê°€ ì—¬ê¸°ì— í‘œì‹œë¨ -->
                        <div id="answer-recipe-display" class="flex justify-center gap-2 flex-wrap"></div>
                    </div>

                    <div class="flex flex-col gap-3">
                        <button id="show-answer-btn" onclick="revealAnswer()" class="w-full py-4 bg-white border-2 border-indigo-200 text-indigo-600 text-xl rounded-2xl hover:bg-indigo-50 transition-colors font-bold">
                            ğŸ” ì •ë‹µ ë¹„ë²• ë³´ê¸°
                        </button>
                        <button onclick="nextLevel()" class="w-full py-5 bg-indigo-600 hover:bg-indigo-700 text-white text-2xl rounded-2xl transition-colors font-bold shadow-lg">
                            ë‹¤ìŒ ë¬¸ì œ í’€ê¸°
                        </button>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        const PAINTS = {
            red:    { c: 6, m: 73, y: 73, k: 0, hex: '#ef4444', name: 'ë¹¨ê°•' },
            orange: { c: 2, m: 55, y: 91, k: 0, hex: '#f97316', name: 'ì£¼í™©' },
            yellow: { c: 2, m: 20, y: 92, k: 0, hex: '#facc15', name: 'ë…¸ë‘' },
            green:  { c: 87, m: 23, y: 63, k: 0, hex: '#22c55e', name: 'ì´ˆë¡' },
            blue:   { c: 85, m: 61, y: 8, k: 0, hex: '#2563eb', name: 'íŒŒë‘' },
            purple: { c: 42, m: 80, y: 8, k: 0, hex: '#9333ea', name: 'ë³´ë¼' },
            pink:   { c: 4, m: 55, y: 29, k: 0, hex: '#f472b6', name: 'ë¶„í™' },
            brown:  { c: 45, m: 73, y: 93, k: 0, hex: '#8B4513', name: 'ê°ˆìƒ‰' },
            white:  { c: 0, m: 0, y: 0, k: 0, hex: '#ffffff', name: 'í°ìƒ‰' },
            black:  { c: 88, m: 84, y: 78, k: 0, hex: '#1f2937', name: 'ê²€ì •' }
        };

        let currentDrops = [];
        let targetDrops = [];
        let targetRGB = null;

        // --- [ìë™ í¬ê¸° ì¡°ì ˆ] ---
        function resizeGame() {
            const wrapper = document.getElementById('game-container-wrapper');
            const targetWidth = 1024; // ê¸°ì¤€ ë„ˆë¹„
            const targetHeight = 1100; // ê¸°ì¤€ ë†’ì´
            
            // ì—¬ë°± 40px ì œì™¸í•œ ê°€ìš© ê³µê°„
            const scaleX = (window.innerWidth - 40) / targetWidth;
            const scaleY = (window.innerHeight - 40) / targetHeight;
            
            // ë¹„ìœ¨ ìœ ì§€í•˜ë©° í™”ë©´ì— ë§ì¶¤
            let scale = Math.min(scaleX, scaleY);

            wrapper.style.transform = `scale(${scale})`;
        }

        window.addEventListener('resize', resizeGame);
        window.addEventListener('load', () => {
            resizeGame();
            initGame();
        });

        function initGame() {
            resetMix();
            generateTargetColor();
            document.getElementById('result-modal').classList.add('hidden');
            document.getElementById('target-overlay').style.opacity = '0';
            document.getElementById('answer-section').classList.add('hidden');
            document.getElementById('show-answer-btn').style.display = 'block';
        }

        function generateTargetColor() {
            targetDrops = [];
            const keys = Object.keys(PAINTS);
            const dropCount = Math.floor(Math.random() * 3) + 2;

            if (Math.random() > 0.6) {
                targetDrops.push('white');
                targetDrops.push('white');
            }

            for(let i=0; i<dropCount; i++) {
                const randomKey = keys[Math.floor(Math.random() * keys.length)];
                targetDrops.push(randomKey);
            }

            const mixedCMYK = calculateMix(targetDrops);
            targetRGB = cmykToRgb(mixedCMYK.c, mixedCMYK.m, mixedCMYK.y, mixedCMYK.k);
            
            const targetDiv = document.getElementById('target-color');
            targetDiv.style.backgroundColor = `rgb(${targetRGB.r}, ${targetRGB.g}, ${targetRGB.b})`;
        }

        function addDrop(colorKey) {
            currentDrops.push(colorKey);
            updateMixDisplay();
            document.getElementById('empty-msg').style.display = 'none';
        }

        function updateMixDisplay() {
            if (currentDrops.length === 0) {
                document.getElementById('my-color').style.backgroundColor = '#ffffff';
                document.getElementById('empty-msg').style.display = 'block';
                document.getElementById('recipe-display').innerHTML = '<span class="text-gray-400">ì•„ì§ ë¬¼ê°ì„ ë„£ì§€ ì•Šì•˜ì–´ìš”</span>';
                return;
            }

            const mixedCMYK = calculateMix(currentDrops);
            const rgb = cmykToRgb(mixedCMYK.c, mixedCMYK.m, mixedCMYK.y, mixedCMYK.k);
            
            const myColorDiv = document.getElementById('my-color');
            myColorDiv.style.backgroundColor = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;

            updateRecipeBar();
        }

        function updateRecipeBar() {
            const bar = document.getElementById('recipe-display');
            bar.innerHTML = '';
            
            const counts = {};
            currentDrops.forEach(c => counts[c] = (counts[c] || 0) + 1);
            const total = currentDrops.length;

            for (const [key, count] of Object.entries(counts)) {
                if (count === 0) continue;
                const width = (count / total) * 100;
                const colorHex = PAINTS[key].hex;
                const isLight = ['white', 'yellow', 'pink'].includes(key);
                const textColor = isLight ? 'text-black' : 'text-white';
                
                const segment = document.createElement('div');
                segment.style.width = `${width}%`;
                segment.style.backgroundColor = colorHex;
                segment.className = `h-full flex items-center justify-center text-lg font-bold ${textColor}`;
                segment.innerHTML = count;
                bar.appendChild(segment);
            }
        }

        // --- [í•µì‹¬ ìˆ˜ì •] êµê³¼ì„œ ì´ë¡  ê¸°ë°˜ í˜¼í•© ë¡œì§ (Textbook Logic) ---
        function calculateMix(dropsArray) {
            if (dropsArray.length === 0) return { c:0, m:0, y:0, k:0 };

            let totalC = 0, totalM = 0, totalY = 0, totalK = 0;
            // 3ì›ìƒ‰ ì¡´ì¬ ì—¬ë¶€ ì¶”ì 
            let hasRed = false;
            let hasYellow = false;
            let hasBlue = false;

            dropsArray.forEach(key => {
                const p = PAINTS[key];
                totalC += p.c;
                totalM += p.m;
                totalY += p.y;
                totalK += p.k;

                if (key === 'red') hasRed = true;
                if (key === 'yellow') hasYellow = true;
                if (key === 'blue') hasBlue = true;
            });

            const count = dropsArray.length;
            let avgC = totalC / count;
            let avgM = totalM / count;
            let avgY = totalY / count;
            let avgK = totalK / count;

            // [ê·œì¹™ 1] ë¹¨ê°• + ë…¸ë‘ + íŒŒë‘ = ê²€ì • (The Black Rule)
            // 3ì›ìƒ‰ì´ ëª¨ë‘ ì„ì´ë©´ ì´ë¡ ìƒ ê²€ì •ì´ ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
            if (hasRed && hasYellow && hasBlue) {
                // ê°•ì œë¡œ K(ê²€ì •) ê°’ì„ ë†’ì—¬ì„œ í™•ì‹¤í•œ ê²€ì •/ì§™ì€ íšŒìƒ‰ì„ ë§Œë“­ë‹ˆë‹¤.
                // ê¸°ì¡´ì˜ ì§„í™ìƒ‰(Muddy Brown)ì„ ë®ì–´ì”Œì›ë‹ˆë‹¤.
                avgK = Math.max(avgK, 85); 
                avgC = Math.max(avgC, 60); // ê¹Šì´ê° ì¶”ê°€
                avgM = Math.max(avgM, 60);
                avgY = Math.max(avgY, 60);
            }
            // [ê·œì¹™ 2] ë…¸ë‘ + íŒŒë‘ = ì´ˆë¡ (Green Correction)
            // ë‹¨, ë¹¨ê°•ì´ ì—†ì„ ë•Œë§Œ ì ìš© (ë¹¨ê°•ì´ ìˆìœ¼ë©´ ê²€ì •ì´ ë˜ì–´ì•¼ í•˜ë¯€ë¡œ)
            else if (hasYellow && hasBlue && !hasRed) {
                // íŒŒë‘ì˜ Magenta ì„±ë¶„ì„ ì œê±°í•˜ì—¬ ë§‘ì€ ì´ˆë¡ì„ ë§Œë“­ë‹ˆë‹¤.
                avgM = avgM * 0.2;
                const maxCY = Math.max(avgC, avgY);
                // Cyanê³¼ Yellowë¥¼ ê°•ì¡°
                avgC = (avgC + maxCY) / 1.6;
                avgY = (avgY + maxCY) / 1.6;
            }
            // [ê·œì¹™ 3] ë¹¨ê°• + íŒŒë‘ = ë³´ë¼ (Purple Correction)
            // ë‹¨, ë…¸ë‘ì´ ì—†ì„ ë•Œë§Œ ì ìš©
            else if (hasRed && hasBlue && !hasYellow) {
                // ë¹¨ê°•ì˜ Yellow ì„±ë¶„ì„ ì œê±°í•˜ì—¬ ë§‘ì€ ë³´ë¼ë¥¼ ë§Œë“­ë‹ˆë‹¤.
                avgY = avgY * 0.2;
                const maxCM = Math.max(avgC, avgM);
                avgC = (avgC + maxCM) / 1.8;
                avgM = (avgM + maxCM) / 1.8;
            }
            // [ê·œì¹™ 4] ë¹¨ê°• + ë…¸ë‘ = ì£¼í™© (Orange Correction)
            else if (hasRed && hasYellow && !hasBlue) {
                 // ë³´í†µ ì˜ ë‚˜ì˜¤ì§€ë§Œ í™•ì‹¤í•˜ê²Œ í•˜ê¸° ìœ„í•´ Cyan ì œê±°
                 avgC = avgC * 0.1;
            }

            // ì¼ë°˜ì ì¸ 'íƒí•¨' ì²˜ë¦¬ (ì—¬ëŸ¬ ìƒ‰ ì„ì„)
            const minCMY = Math.min(avgC, avgM, avgY);
            if (minCMY > 10) { 
                // ìƒ‰ì´ 3ê°œ ì´ìƒ ì„ì—¬ì„œ íƒí•´ì§€ë©´ ê²€ì • ê¸°ìš´ì„ ì¶”ê°€
                avgK += minCMY * 1.5;
            }
            
            return {
                c: Math.min(100, avgC),
                m: Math.min(100, avgM),
                y: Math.min(100, avgY),
                k: Math.min(100, avgK)
            };
        }

        function cmykToRgb(c, m, y, k) {
            c = c / 100;
            m = m / 100;
            y = y / 100;
            k = k / 100;

            let r = 255 * (1 - c) * (1 - k);
            let g = 255 * (1 - m) * (1 - k);
            let b = 255 * (1 - y) * (1 - k);

            return {
                r: Math.round(r),
                g: Math.round(g),
                b: Math.round(b)
            };
        }

        function resetMix() {
            currentDrops = [];
            updateMixDisplay();
        }

        function checkResult() {
            if (currentDrops.length === 0) {
                alert("ë¬¼ê°ì„ ìµœì†Œ í•œ ë°©ìš¸ì€ ë„£ì–´ì•¼ í•´ìš”!");
                return;
            }

            const mixedCMYK = calculateMix(currentDrops);
            const myRGB = cmykToRgb(mixedCMYK.c, mixedCMYK.m, mixedCMYK.y, mixedCMYK.k);

            const dist = Math.sqrt(
                Math.pow(targetRGB.r - myRGB.r, 2) +
                Math.pow(targetRGB.g - myRGB.g, 2) +
                Math.pow(targetRGB.b - myRGB.b, 2)
            );

            let score = Math.max(0, 100 - (dist / 2.5)); 
            score = Math.round(score);

            showResult(score, myRGB);
        }

        function showResult(score, myRGB) {
            const modal = document.getElementById('result-modal');
            const icon = document.getElementById('result-icon');
            const title = document.getElementById('result-title');
            const desc = document.getElementById('result-desc');
            const scoreText = document.getElementById('score-text');
            const scoreBar = document.getElementById('score-bar');
            
            document.getElementById('target-overlay').style.opacity = '1';

            document.getElementById('modal-target-color').style.backgroundColor = 
                `rgb(${targetRGB.r}, ${targetRGB.g}, ${targetRGB.b})`;
            document.getElementById('modal-my-color').style.backgroundColor = 
                `rgb(${myRGB.r}, ${myRGB.g}, ${myRGB.b})`;

            if (score >= 95) {
                icon.textContent = "ğŸ†";
                title.textContent = "ì‹ ì˜ ê²½ì§€!";
                desc.textContent = "ê¸°ê³„ë³´ë‹¤ ì •í™•í•œ ëˆˆì„ ê°€ì§€ì…¨êµ°ìš”!";
                title.className = "text-5xl mb-4 text-indigo-600 font-bold";
            } else if (score >= 80) {
                icon.textContent = "ğŸ¨";
                title.textContent = "ì•„ì£¼ í›Œë¥­í•´ìš”!";
                desc.textContent = "ê±°ì˜ ì™„ë²½í•˜ê²Œ ë˜‘ê°™ì•„ìš”.";
                title.className = "text-5xl mb-4 text-green-600 font-bold";
            } else if (score >= 50) {
                icon.textContent = "ğŸ¤”";
                title.textContent = "ì¡°ê¸ˆ ì•„ì‰¬ì›Œìš”";
                desc.textContent = "ìƒ‰ì´ ë¹„ìŠ·í•˜ê¸´ í•œë°, í†¤ì„ ë§ì¶°ë³´ì„¸ìš”.";
                title.className = "text-5xl mb-4 text-yellow-500 font-bold";
            } else {
                icon.textContent = "ğŸ¤ª";
                title.textContent = "ì™„ì „ ë‹¤ë¥¸ë°ìš”?";
                desc.textContent = "ê´œì°®ì•„ìš”, ì˜ˆìˆ ì€ ììœ ë‹ˆê¹Œìš”!";
                title.className = "text-5xl mb-4 text-red-500 font-bold";
            }

            scoreText.textContent = `${score}ì `;
            
            modal.classList.remove('hidden');
            
            setTimeout(() => {
                scoreBar.style.width = `${score}%`;
                if(score < 50) scoreBar.className = "h-8 rounded-full transition-all duration-1000 bg-red-500";
                else if(score < 80) scoreBar.className = "h-8 rounded-full transition-all duration-1000 bg-yellow-400";
                else scoreBar.className = "h-8 rounded-full transition-all duration-1000 bg-green-500";
            }, 100);
        }

        function revealAnswer() {
            const answerContainer = document.getElementById('answer-recipe-display');
            answerContainer.innerHTML = '';
            
            const counts = {};
            targetDrops.forEach(c => counts[c] = (counts[c] || 0) + 1);

            for (const [key, count] of Object.entries(counts)) {
                const paint = PAINTS[key];
                
                const chip = document.createElement('div');
                chip.className = "flex items-center gap-2 bg-white px-3 py-2 rounded-xl shadow-sm border border-gray-100";
                
                const colorDot = document.createElement('div');
                colorDot.className = "w-6 h-6 rounded-full border border-gray-200";
                colorDot.style.backgroundColor = paint.hex;
                
                const text = document.createElement('span');
                text.className = "text-lg font-bold text-gray-700";
                text.textContent = `${paint.name} ${count}`;
                
                chip.appendChild(colorDot);
                chip.appendChild(text);
                answerContainer.appendChild(chip);
            }

            document.getElementById('answer-section').classList.remove('hidden');
            document.getElementById('show-answer-btn').style.display = 'none';
        }

        function nextLevel() {
            initGame();
        }

    </script>
</body>
</html>